# üö® –°–†–û–ß–ù–û: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞—Å—Å—ã–ª–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–¢–æ–ª—å–∫–æ 4 –∏–∑ 12 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–∞. –ü—Ä–∏—á–∏–Ω–∞: **Rate Limit –æ—Ç Resend API (2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫)**.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 600ms –º–µ–∂–¥—É –ø–∏—Å—å–º–∞–º–∏ –≤ newsletter worker  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
git add -A
git commit -m "fix: add rate limiting delay to newsletter worker (600ms between emails)"
git push origin main
```

### 2. –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è –Ω–∞ Vercel (~2-3 –º–∏–Ω—É—Ç—ã)

### 3. –ü–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ 8 –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∏ 8 —á–µ–ª–æ–≤–µ–∫ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ –∏–∑-–∑–∞ rate limit:

- yrashkin@gmail.com
- merkurov@gmail.com
- vatrakhtenberg@gmail.com
- nick.barabanov@gmail.com
- romaninvenice@gmail.com
- tatiana@manoukovski.com
- alexandr.belyshkin@gmail.com
- vshimanovich@gmail.com (–ø–æ–ª—É—á–∏–ª —Ç–æ–ª—å–∫–æ 1 –∏–∑ 2 –ø–∏—Å–µ–º)

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å `sentAt` –¥–ª—è –ø–∏—Å—å–º–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–æ–≤–∞

### 4. –°–±—Ä–æ—Å–∏—Ç—å sentAt –¥–ª—è –ø–∏—Å—å–º–∞

**–ó–∞–ø—Ä–æ—Å –≤ Supabase Dashboard:**

```sql
-- –ù–∞–π—Ç–∏ ID –ø–∏—Å—å–º–∞
SELECT id, title, "sentAt"
FROM letters
WHERE title = '–ü—å–µ—Ä–æ: —Å–µ—Ä–± –∏ –º–æ–ª–æ–¥';

-- –°–±—Ä–æ—Å–∏—Ç—å sentAt (–∏—Å–ø–æ–ª—å–∑—É–π ID –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
UPDATE letters
SET "sentAt" = NULL
WHERE id = 'xzlpk7h1axac1lufhw9fvu6b';
```

### 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å–Ω–æ–≤–∞

–ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ `sentAt` –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin/letters/edit/[id]` –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É".

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø–∏—Å—å–º–∞ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π**, –∏ –≤—Å–µ 12 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø–æ–ª—É—á–∞—Ç –ø–∏—Å—å–º–æ.

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

**–î—É–±–ª–∏–∫–∞—Ç—ã:** 4 –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ (ayellin, makarluba, 4104466, anya11) –ø–æ–ª—É—á–∞—Ç –ø–∏—Å—å–º–æ **—Ç—Ä–µ—Ç–∏–π —Ä–∞–∑**.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

1. –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å - –ø—É—Å—Ç—å –ø–æ–ª—É—á–∞—Ç 3 –∫–æ–ø–∏—é (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–∏—Å—å–º–∞)
2. –ù–∞–ø–∏—Å–∞—Ç—å –∏–∑–≤–∏–Ω–µ–Ω–∏—è —ç—Ç–∏–º 4-–º –ª—é–¥—è–º
3. –í—Ä—É—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–∞ —Ç–æ–ª—å–∫–æ 8 –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º —á–µ—Ä–µ–∑ Resend Dashboard

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 1 (–ø—Ä–æ—â–µ –≤—Å–µ–≥–æ) - –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç–∞–∫–æ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è.

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–ó–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤:**

```sql
SELECT
  nl.id,
  s.email as subscriber_email,
  nl.status,
  nl.sent_at,
  nl.error_message,
  nl.provider_response->>'statusCode' as status_code
FROM newsletter_logs nl
JOIN subscribers s ON s.id = nl.subscriber_id
WHERE nl.job_id IN (
  SELECT id FROM newsletter_jobs
  WHERE created_at > NOW() - INTERVAL '1 hour'
  ORDER BY created_at DESC
  LIMIT 1
)
ORDER BY nl.sent_at DESC;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 12 —Å—Ç—Ä–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `sent` –∏ –±–µ–∑ –æ—à–∏–±–æ–∫ `rate_limit_exceeded`.

---

**–î–∞—Ç–∞:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é
